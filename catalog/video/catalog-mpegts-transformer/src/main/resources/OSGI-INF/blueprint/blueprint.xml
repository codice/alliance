<?xml version="1.0" encoding="UTF-8"?>
<!--
/**
 * Copyright (c) Connexta, LLC
 *
 * This is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser General Public License as published by the Free Software Foundation, either
 * version 3 of the License, or any later version.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 * See the GNU Lesser General Public License for more details. A copy of the GNU Lesser General Public License is distributed along with this program and can be found at
 * <http://www.gnu.org/licenses/lgpl.html>.
 *
 **/
 -->
<blueprint xmlns:cm="http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.1.0" xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0">

    <reference id="tikaInputTransformer" interface="ddf.catalog.transform.InputTransformer" filter="(id=tika)"
               availability="mandatory"/>

    <reference-list id="metacardTypeList" interface="ddf.catalog.data.MetacardType" filter="(name=MpegTsMetacardType)" availability="mandatory" />

    <bean id="transformer" class="com.connexta.transformer.video.MpegTsInputTransformer">

        <cm:managed-properties persistent-id="com.connexta.transformer.video.MpegTsInputTransformer"
                               update-strategy="container-managed" />
        <argument ref="tikaInputTransformer"/>
        <argument ref="metacardTypeList"/>
        <argument>
            <bean class="com.connexta.alliance.libs.klv.Stanag4609ProcessorImpl">
                <argument>
                    <bean class="com.connexta.alliance.libs.klv.OffsetCenterPostProcessor"/>
                </argument>
            </bean>
        </argument>
        <argument>
            <bean class="com.connexta.alliance.libs.klv.KlvHandlerFactoryImpl"/>
        </argument>
        <argument>
            <bean class="com.connexta.alliance.libs.klv.LoggingKlvHandler"/>
        </argument>
        <argument>
            <bean class="com.connexta.alliance.libs.klv.StanagParserFactoryImpl"/>
        </argument>
        <argument>
            <bean class="com.connexta.alliance.libs.klv.ListKlvProcessor">
                <argument>
                    <list>
                        <bean class="com.connexta.alliance.libs.klv.LocationKlvProcessor"/>
                        <bean class="com.connexta.alliance.libs.klv.SetDatesKlvProcessor"/>
                        <bean class="com.connexta.alliance.libs.klv.MissionIdKlvProcessor"/>
                        <bean class="com.connexta.alliance.libs.klv.PlatformDesignationKlvProcessor"/>
                        <bean class="com.connexta.alliance.libs.klv.ImageSourceSensorKlvProcessor"/>
                        <bean class="com.connexta.alliance.libs.klv.ObjectCountryCodesKlvProcessor"/>
                        <bean class="com.connexta.alliance.libs.klv.SecurityClassificationKlvProcessor"/>
                        <bean class="com.connexta.alliance.libs.klv.FrameCenterKlvProcessor"/>
                        <bean class="com.connexta.alliance.libs.klv.ClassifyingCountryKlvProcessor"/>
                    </list>
                </argument>
            </bean>
        </argument>
    </bean>

    <service ref="transformer" interface="ddf.catalog.transform.InputTransformer">
        <service-properties>
            <entry key="id" value="mpegts"/>
            <!-- shortname only exists for backwards compatibility -->
            <entry key="shortname" value="mpegts"/>
            <entry key="title" value="MPEGTS Input Transformer"/>
            <entry key="description"
                   value="Extracts stanag 4609 metadata from MPEG-TS files"/>
            <entry key="mime-type">
                <list>
                    <value>video/mp2t</value>
                </list>
            </entry>
        </service-properties>
    </service>

</blueprint>